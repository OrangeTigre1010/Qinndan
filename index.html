<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼ æ²ä¸¹å…­æœˆæ¼”ä»€ä¹ˆæˆï¼Ÿ</title>
    <!-- å¼•å…¥Leafletåœ°å›¾åº“ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        html, body, [class*="css"] {
            font-family: 'STZhongsong', 'SimSun', serif;
        }
        
        body {
            background-color: #ffffff;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            gap: 20px;
        }
        
        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            background-color: #fff0f0;
            padding: 20px;
            border-radius: 8px;
            width: 250px;
            min-height: 1000px;
            flex-shrink: 0;
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* è½®æ’­å›¾+å‰§ç›®è¡¨å®¹å™¨ */
        .right-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* è½®æ’­å›¾æ ·å¼ */
        .carousel {
            position: relative;
            width: 100%;
            height: 450px;
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .carousel-inner {
            display: flex;
            transition: transform 0.5s ease;
            height: 100%;
        }
        
        .carousel-item {
            min-width: 100%;
            height: 100%;
        }
        
        .carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .musical-card {
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #fff5f5;
            border-left: 5px solid #d23c3c;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .musical-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .musical-title {
            color: #8c1a1a;
            font-weight: bold;
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .theater-name {
            color: #d23c3c;
            font-weight: bold;
            font-size: 1.1em;
            margin: 8px 0;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .custom-button {
            background-color: #d23c3c;
            color: white;
            border-radius: 5px;
            padding: 8px 16px;
            border: none;
            font-weight: bold;
            transition: background-color 0.3s;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
        }
        
        .custom-button:hover {
            background-color: #991a1a;
            color: white;
        }
        
        /* é€‰é¡¹å¡æ ·å¼ */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            color: #d23c3c;
        }
        
        .tab.active {
            color: #8c1a1a;
            border-bottom: 3px solid #d23c3c;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        select {
            width: 100%;
            height: 40px;
            font-size: 16px;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ffd0d0;
            border-radius: 4px;
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            color: #8c1a1a;
            border-bottom: 2px solid #d23c3c;
            padding-bottom: 10px;
        }
        
        /* è¡¨å•æ ·å¼ */
        input, textarea {
            border: 1px solid #ffd0d0;
            border-radius: 4px;
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ffd0d0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ffd0d0;
        }
        
        th {
            background-color: #fff0f0;
            color: #8c1a1a;
        }
        
        /* æ¼”å‘˜ä»‹ç»å¡ç‰‡ */
        .actor-card {
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background-color: #f8f8f8;
            border-left: 5px solid #8c1a1a;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .actor-name {
            color: #8c1a1a;
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .flex-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .flex-img {
            flex: 0 0 200px;
        }
        
        .flex-content {
            flex: 1;
        }
        
        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* åœ°å›¾è§†å›¾å®¹å™¨ */
        .map-view-container {
            display: flex;
            gap: 20px;
            width: 100%;
        }
        
        /* åœ°å›¾æ ·å¼ */
        #map {
            height: 500px;
            flex-grow: 1;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        /* å‰§é™¢åˆ—è¡¨æ ·å¼ */
        .theater-list-container {
            width: 300px;
            background-color: #fff0f0;
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            max-height: 500px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .theater-list-container h3 {
            color: #8c1a1a;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #d23c3c;
            text-align: center;
            font-size: 1.2em;
        }
        
        .theater-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .theater-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            background-color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid #d23c3c;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .theater-item:hover {
            background-color: #ffecec;
            transform: translateX(5px);
        }
        
        .theater-item.active {
            background-color: #d23c3c;
            color: white;
        }
        
        .theater-item .theater-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .theater-item .performance-count {
            font-size: 0.9em;
            color: #666;
            display: flex;
            justify-content: space-between;
        }
        
        .theater-item.active .performance-count {
            color: #ddd;
        }
        
        /* ç­›é€‰æŒ‰é’® */
        .filter-button {
            background-color: #d23c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            width: 100%;
        }
        
        .filter-button:hover {
            background-color: #991a1a;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                min-height: auto;
            }
            
            .flex-container {
                flex-direction: column;
            }
            
            .flex-img {
                flex: 0 0 auto;
                width: 100%;
            }
            
            .map-view-container {
                flex-direction: column;
            }
            
            .theater-list-container {
                width: 100%;
                max-height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>ğŸ­ ç­›é€‰æ¡ä»¶</h2>
            
            <!-- æ—¥æœŸèŒƒå›´é€‰æ‹© -->
            <label for="dateRange">é€‰æ‹©æ—¥æœŸèŒƒå›´</label>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <input type="date" id="startDate" style="flex: 1;">
                <input type="date" id="endDate" style="flex: 1;">
            </div>
            
            <!-- å‰§é™¢é€‰æ‹© -->
            <label for="theaters">é€‰æ‹©å‰§é™¢</label>
            <select id="theaters">
                <option value="all" selected>å…¨éƒ¨å‰§é™¢</option>
                <option value="å¥¹å‰§åœº">å¥¹å‰§åœº</option>
                <option value="åä¸€æ¥¼å“ªä¸ªå‰§åœº">åä¸€æ¥¼å“ªä¸ªå‰§åœº</option>
                <option value="ä¸Šæµ·èŒ‰è‰èŠ±å‰§åœº">ä¸Šæµ·èŒ‰è‰èŠ±å‰§åœº</option>
                <option value="åŒ—äº¬ä¿åˆ©å‰§é™¢">åŒ—äº¬ä¿åˆ©å‰§é™¢</option>
                <option value="å¤§ä¸–ç•Œ">å¤§ä¸–ç•Œ</option>
                <option value="å¢¨å‰§åœº">å¢¨å‰§åœº</option>
            </select>
            
            <!-- ç¥¨ä»·èŒƒå›´ -->
            <label for="priceRanges">é€‰æ‹©ç¥¨ä»·èŒƒå›´</label>
            <select id="priceRanges">
                <option value="all" selected>å…¨éƒ¨ç¥¨ä»·</option>
                <option value="280-1280å…ƒ">280-1280å…ƒ</option>
                <option value="180-1080å…ƒ">180-1080å…ƒ</option>
                <option value="200-880å…ƒ">200-880å…ƒ</option>
                <option value="380-1680å…ƒ">380-1680å…ƒ</option>
                <option value="180-980å…ƒ">180-980å…ƒ</option>
            </select>
            
            <!-- æ’åºæ–¹å¼ -->
            <label for="sortBy">æ’åºæ–¹å¼</label>
            <select id="sortBy">
                <option value="date_asc">æ¼”å‡ºæ—¥æœŸ(ä»æ—©åˆ°æ™š)</option>
                <option value="date_desc">æ¼”å‡ºæ—¥æœŸ(ä»æ™šåˆ°æ—©)</option>
                <option value="name_asc">å‰§ç›®åç§°(A-Z)</option>
                <option value="name_desc">å‰§ç›®åç§°(Z-A)</option>
                <option value="theater_asc">å‰§é™¢åç§°(A-Z)</option>
                <option value="theater_desc">å‰§é™¢åç§°(Z-A)</option>
            </select>
            
            <button class="filter-button" onclick="applyFilters()">åº”ç”¨ç­›é€‰</button>
            <button class="filter-button" onclick="resetFilters()" style="background-color: #666; margin-top: 5px;">é‡ç½®ç­›é€‰</button>
            
            <hr>
            <p><strong>å…³äº</strong></p>
            <p>æœ¬åº”ç”¨æä¾›å¼ æ²ä¸¹å½“æœˆæ¼”å‡ºä¿¡æ¯</p>
        </div>

        <div class="main-content">
            <!-- é¡¶éƒ¨è½®æ’­å›¾ -->
            <div class="carousel">
                <div class="carousel-inner" id="carouselInner">
                    <div class="carousel-item"><img src="https://i.imgur.com/KUOhkeq.jpeg" alt="å¼ æ²ä¸¹æ¼”å‡ºæµ·æŠ¥"></div>
                    <div class="carousel-item"><img src="https://i.imgur.com/3KAIyAH.jpeg" alt="å¼ æ²ä¸¹æ¼”å‡ºæµ·æŠ¥"></div>
                    <div class="carousel-item"><img src="https://i.imgur.com/VUZF7sX.jpeg" alt="å¼ æ²ä¸¹æ¼”å‡ºæµ·æŠ¥"></div>
                    <div class="carousel-item"><img src="https://i.imgur.com/wy2k5Qv.jpeg" alt="å¼ æ²ä¸¹æ¼”å‡ºæµ·æŠ¥"></div>
                </div>
            </div>
            
            <h1>ğŸ¥šå¼ æ²ä¸¹å…­æœˆæ¼”ä»€ä¹ˆæˆï¼Ÿ</h1>
            <p>æŸ¥çœ‹ç¦½è›‹ğŸ¥šæœ€æ–°æ¼”å‡ºä¿¡æ¯</p>
            
            <!-- å…³äºå¼ æ²ä¸¹ -->
            <div class="actor-card">
                <div class="actor-name">å¼ æ²ä¸¹</div>
                <div class="flex-container">
                    <div class="flex-img">
                        <img src="https://i.imgur.com/LzIVhfL.jpeg" alt="å¼ æ²ä¸¹" style="width: 100%; border-radius: 8px;">
                    </div>
                    <div class="flex-content">
                        <p><strong>èŒä¸šï¼š</strong>éŸ³ä¹å‰§æ¼”å‘˜</p>
                        <p><strong>ä»£è¡¨ä½œå“ï¼š</strong>ã€Šäººé—´å¤±æ ¼ã€‹ã€Šä¼ªè£…è€…2022ã€‹ã€ŠçŒç½ªå›¾é‰´ã€‹ã€Šé“æ—æ ¼é›·çš„ç”»åƒã€‹</p>
                        <p><strong>ç®€ä»‹ï¼š</strong>å¼ æ²ä¸¹æ˜¯ä¸­å›½æ–°ç”Ÿä»£éŸ³ä¹å‰§æ¼”å‘˜ï¼Œä»¥å…¶æ‰å®çš„å”±åŠŸå’Œå¯Œæœ‰æ„ŸæŸ“åŠ›çš„è¡¨æ¼”é£æ ¼å—åˆ°è§‚ä¼—å–œçˆ±ã€‚æ¯•ä¸šäºä¸Šæµ·éŸ³ä¹å­¦é™¢éŸ³ä¹å‰§ç³»ï¼Œæ›¾å‡ºæ¼”å¤šéƒ¨ç»å…¸éŸ³ä¹å‰§ä½œå“ï¼Œå¡‘é€ äº†å¤šä¸ªä»¤äººå°è±¡æ·±åˆ»çš„è§’è‰²å½¢è±¡ã€‚</p>
                        <p><strong>æ¼”å‡ºç‰¹ç‚¹ï¼š</strong>å£°éŸ³æ¸…æ¾ˆé€äº®ï¼Œè¡¨æ¼”ç»†è…»çœŸå®ï¼Œæ“…é•¿å¡‘é€ å¤æ‚å¤šé¢çš„å¥³æ€§è§’è‰²ã€‚</p>
                    </div>
                </div>
            </div>
            
            <div class="right-section">
                <p><strong id="performanceCount">æ‰¾åˆ° 6 åœºæ¼”å‡º</strong></p>
                
                <!-- é€‰é¡¹å¡ -->
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('cardView')">å¡ç‰‡è§†å›¾</div>
                    <div class="tab" onclick="switchTab('tableView')">è¡¨æ ¼è§†å›¾</div>
                    <div class="tab" onclick="switchTab('mapView')">åœ°å›¾è§†å›¾</div>
                </div>
                
                <!-- å¡ç‰‡è§†å›¾ -->
                <div id="cardView" class="tab-content active">
                    <!-- å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- è¡¨æ ¼è§†å›¾ -->
                <div id="tableView" class="tab-content">
                    <table>
                        <thead>
                            <tr>
                                <th>å‰§ç›®åç§°</th>
                                <th>æ¼”å‡ºæ—¥æœŸ</th>
                                <th>æ¼”å‡ºæ—¶é—´</th>
                                <th>å‰§é™¢åç§°</th>
                                <th>ç¥¨ä»·èŒƒå›´</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
                
                <!-- åœ°å›¾è§†å›¾ -->
                <div id="mapView" class="tab-content">
                    <h2>æ¼”å‡ºåœ°ç‚¹åˆ†å¸ƒ</h2>
                    <div class="map-view-container">
                        <div class="theater-list-container">
                            <h3>ğŸ­ å‰§é™¢åˆ—è¡¨ ğŸ­</h3>
                            <ul class="theater-list" id="theaterList">
                                <!-- å‰§é™¢åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </ul>
                        </div>
                        <div id="map"></div>
                    </div>
                </div>
            </div>
            
            <!-- é—æ¼æ¼”å‡ºåé¦ˆ -->
            <hr>
            <h2>é—æ¼æ¼”å‡ºåé¦ˆ</h2>
            <form id="addPerformance">
                <div class="flex-container">
                    <div class="flex-content">
                        <label for="title">å‰§ç›®åç§°*</label>
                        <input type="text" id="title" required>
                        
                        <label for="theater">å‰§é™¢åç§°*</label>
                        <input type="text" id="theater" required>
                        
                        <label for="date">æ¼”å‡ºæ—¥æœŸ*</label>
                        <input type="date" id="date" required>
                    </div>
                    <div class="flex-content">
                        <label for="time">æ¼”å‡ºæ—¶é—´*</label>
                        <input type="time" id="time" value="19:30" required>
                        
                        <label for="price">ç¥¨ä»·èŒƒå›´* (ä¾‹å¦‚: 280-1280å…ƒ)</label>
                        <input type="text" id="price" required>
                        
                        <label for="link">è´­ç¥¨é“¾æ¥</label>
                        <input type="url" id="link">
                    </div>
                </div>
                
                <label for="description">å‰§ç›®ç®€ä»‹</label>
                <textarea id="description" rows="4"></textarea>
                
                <label for="poster">æµ·æŠ¥å›¾ç‰‡URL</label>
                <input type="url" id="poster">
                
                <button type="button" onclick="submitForm()" class="custom-button">æäº¤åé¦ˆ</button>
            </form>
            
            <!-- å…³äºéƒ¨åˆ† -->
            <hr>
            <p><strong>å…³äºè¿™ä¸ªåº”ç”¨</strong></p>
            <ul>
                <li>æ•°æ®æ¥æº: å„å¤§å‰§é™¢å®˜ç½‘</li>
                <li>æœ€åæ›´æ–°æ—¶é—´: <span id="updateDate"></span></li>
                <li>å¼€å‘è€…: å¼µæ²ä¸¹çš„ç‹—</li>
            </ul>
        </div>
    </div>

    <!-- å¼•å…¥Leafletåœ°å›¾åº“JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    
    <script>
        // æ¼”å‡ºæ•°æ®
        const performances = [
            {
                id: 1,
                title: "è¿ç’§",
                date: "2025-06-13",
                time: "19:30",
                theater: "å¥¹å‰§åœº",
                price: "280-1280å…ƒ",
                description: "åœ¨æ¡‰åŸä¸€æ‰‹é®å¤©çš„ææ°å®¶æ—ä¸­ï¼Œäººäººçº¸é†‰é‡‘è¿·ã€äº‰æƒå¤ºåˆ©ã€‚é›†å›¢åƒé‡‘æç‰å±ä¸ç¬¬ä¸€ç§˜ä¹¦è°¢å®›å®ï¼Œé’ˆé”‹ç›¸å¯¹æ°´ç«ä¸å®¹ã€‚æ›¾æ˜¯æŒšå‹çš„å¥¹ä»¬ï¼Œä¸ºä½•ä¼šåç›®æˆä»‡ï¼Ÿå‹¾å¿ƒæ–—è§’çš„ååˆ©åœºä¸Šï¼Œå¥¹ä»¬èƒ½å¦å¾—å¿æ‰€æ„¿ï¼Ÿæ·±ä¸è§åº•çš„å‘½è¿æ¼©æ¶¡ä¸­ï¼Œå¥¹ä»¬åˆæ˜¯å¦èƒ½å¤Ÿçœ‹æ¸…è‡ªå·±çš„å†…å¿ƒï¼Ÿæ­å¼€å°˜å°çš„å¾€äº‹ï¼Œèµ°è¿›é‡‘ä¸çš„ç‰¢ç¬¼ï¼Œç§˜å¯†ä¸ç¾ç»Šçš„èˆå°ï¼Œæ‹‰å¼€å¸·å¹•ã€‚",
                poster: "https://i.imgur.com/So5kIsT.jpeg",
                link: "https://mp.weixin.qq.com/s/TvkxIL5pU5s8Dv9tJz9sFg",
                location: [121.481453, 31.242095] // å¥¹å‰§åœº
            },
            {
                id: 2,
                title: "è°¨éµåŒ»å˜±",
                date: "2025-06-14",
                time: "19:30",
                theater: "åä¸€æ¥¼å“ªä¸ªå‰§åœº",
                price: "180-1080å…ƒ",
                description: "ä¸­å¹´é©¬æ‹‰æ¾å…¬ç›Šè·‘è€…é©¬å‹¤æ„å¤–æŸ¥å‡ºæƒ ä¸Šé˜¿å°”å…¹æµ·é»˜ç—‡ï¼Œç”Ÿæ´»æ€¥è½¬è€Œä¸‹ï¼Œå·¥ä½œå¤±åˆ©ï¼Œå®¶åº­ç“¦è§£ï¼Œä»–å‰©ä½™çš„ä¸€åŠäººç”Ÿå¼€å§‹ä¸å€’é€€çš„è®°å¿†èµ›è·‘ã€‚ä»–å†åº¦èµ°è®¿é‚£äº›ä¸è‡ªå·±ç”Ÿæ´»ç›¸å…³çš„äººï¼Œå¼€å¯äº†ä¸€åœºç‹¬å±è‡ªå·±çš„\"å»ä¼ªå­˜çœŸ\"ï¼Œæ‘†åœ¨ä»–é¢å‰çš„ï¼Œæ˜¯äººç”Ÿçš„å‘ä»¤æªï¼Œæ‹¿èµ·æˆ–æ”¾ä¸‹ï¼Œç­”æ¡ˆæ— äººçŸ¥æ™“..",
                poster: "https://i.imgur.com/oe7bnsw.jpeg",
                link: "https://mp.weixin.qq.com/s/VKNxD1aHzpBcgHOTD3kYSw",
                location: [121.484589, 31.2399] // åä¸€æ¥¼å“ªä¸ªå‰§åœº
            },
            {
                id: 3,
                title: "TRACE U",
                date: "2025-06-20",
                time: "14:00",
                theater: "ä¸Šæµ·èŒ‰è‰èŠ±å‰§åœº",
                price: "200-880å…ƒ",
                description: "åœ¨ä¸€å®¶åä¸º\"Debai\"çš„æ‘‡æ»šé…’å§ä¸­ï¼Œä¸»å”±å¯å¤å’Œå‰ä»–æ‰‹åº­å®‡å› ä¸ºçƒ­çˆ±æ‘‡æ»šè€Œå•çº¯åœ°æ´»ç€ã€‚ç„¶è€Œï¼Œä¸€åç¥ç§˜å¥³å­çš„å‡ºç°æ‰“ä¹±äº†ä»–ä»¬åŸæœ¬ç®€å•çš„ç”Ÿæ´»ï¼Œå¯å¤å¯¹å¥³å­æ‰§ç€çš„è¿½é€å¼•å‘äº†ä»–å’Œåº­å®‡ä¹‹é—´æ¥äºŒè¿ä¸‰çš„äº‰æ‰§ã€‚éšç€ä¸¤äººçŸ›ç›¾çš„é€æ¸åŠ æ·±ï¼Œéšè—åœ¨æ—¶é—´å’Œè®°å¿†æ·±å¤„çš„çœŸç›¸æ…¢æ…¢æ˜¾ç°äº†å‡ºæ¥â€¦â€¦",
                poster: "https://i.imgur.com/sxaHw9y.jpeg",
                link: "https://mp.weixin.qq.com/s/yqfXa9SummO5tS75v2PkAA",
                location: [121.484995, 31.236015] // ä¸Šæµ·èŒ‰è‰èŠ±å‰§åœº
            },
            {
                id: 4,
                title: "å®ç‰",
                date: "2025-06-28",
                time: "20:00",
                theater: "åŒ—äº¬ä¿åˆ©å‰§é™¢",
                price: "380-1680å…ƒ",
                description: "éŸ³ä¹å‰§ã€Šå®ç‰ã€‹ä»¥ã€Šçº¢æ¥¼æ¢¦ã€‹ä¸­\"å®ç‰\"çš„è§†è§’,é‡æ–°è§£æ„å’Œè¯ é‡Šè¿™ä¸ªæ•…äº‹ã€‚\"å®ç‰\"ä¸ä»…æŒ‡è´¾å®ç‰æˆ–é€šçµå®ç‰,æ›´æ˜¯ä¸€ç§èº«ä»½ä¸å‘½è¿çš„è±¡å¾ã€‚åœ¨æˆä¸­ï¼Œå®ç‰æ˜¯è´¾å®¶çš„å…¬å­,ä¹Ÿæ˜¯å¤©åœ°é—´çš„é¡½çŸ³,ä»–çš„å‘½è¿ä¼¼ä¹è¢«æå‰å†™å®šã€‚ç„¶è€Œ,è¿™ä¸ªå°‘å¹´åœ¨å¯»æ±‚è‡ªæˆ‘ç­”æ¡ˆçš„è¿‡ç¨‹ä¸­,è´¨ç–‘é¢„è®¾çš„å‘½è¿,æ„Ÿå—å¹¶ç»å†çˆ±æ¨æƒ…ä»‡,æœ€ç»ˆæˆä¸ºå®Œæ•´çš„\"å®ç‰\"ã€‚",
                poster: "https://i.imgur.com/Giy1xkI.jpeg",
                link: "https://mp.weixin.qq.com/s/5LfK_f-9I-tlgq3D-0kCDg",
                location: [116.442332, 39.940532] // åŒ—äº¬ä¿åˆ©å‰§é™¢
            },
            {
                id: 5,
                title: "LIZZIEä¸½å…¹",
                date: "2025-06-14",
                time: "14:00",
                theater: "å¤§ä¸–ç•Œ",
                price: "280-1280å…ƒ",
                description: "1892å¹´8æœˆ4æ—¥ï¼Œä¸€ä¸ªé—·çƒ­å¤æ—¥çš„åˆåï¼Œç¾å›½é©¬å¡è¯¸å¡å·çš„ç¦å°”é‡Œå¼—ï¼Œåå•¬çš„é“¶è¡Œå®¶ AndrewJackson Borden å’Œä»–çš„ç¬¬äºŒä»»å¦»å­ Abby æƒ¨æ­»äºå®¶ä¸­ï¼ŒBorden å…ˆç”Ÿçš„äºŒå¥³å„¿ Lizzie Andrew Bordenæˆä¸ºäº†å¤´å·å«Œç–‘äººã€‚Lizzie çš„å®¡åˆ¤å¼•èµ·äº†è½°åŠ¨ï¼Œä¹Ÿå°†Borden å®¶çš„å¥³ä»† BridgetLizzie çš„å§å§ Emma,å’Œé‚»å±… Alice å·å…¥å…¶ä¸­ã€‚",
                poster: "https://i.imgur.com/medYtwb.png",
                link: "https://mp.weixin.qq.com/s/64sbDcQmHDirJzDPpvvhDA",
                location: [121.485864, 31.234196] // å¤§ä¸–ç•Œ
            },
            {
                id: 6,
                title: "ç–¯å­ä¸èµç¾è¯—",
                date: "2025-06-02",
                time: "19:30",
                theater: "å¢¨å‰§åœº",
                price: "180-980å…ƒ",
                description: "åˆšå‡ºç‹±çš„æé»˜åœ¨é™Œç”Ÿçš„ç¯å¢ƒä¸­æ— æ³•èå…¥ç¤¾ä¼šï¼Œèº«ä½“çš„é¥¥é¥¿å’Œå†…å¿ƒçš„æ€¯æ‡¦è®©ä»–å¤‡å—ç…ç†¬ï¼Œä»–çªç„¶å¼€å§‹æ€€å¿µç›‘ç‹±é‡Œå¼ºè§„åˆ™çš„ç”Ÿæ´»ï¼Œæ‰€ä»¥æé»˜æ‰“ç®—é‡å›ä»–çš„å®‰å…¨åŒºâ€”â€”ç›‘ç‹±ã€‚ä½†å½“ä»–æ•…æ„\"çŠ¯ç½ª\"çš„æ—¶å€™ï¼Œå´é‡åˆ°äº†ä¸ä»–æƒ³æ³•æˆªç„¶ç›¸åï¼Œä¸ºäº†è¿½æ±‚åŒ…ç”±å’Œæ¢¦æƒ³ï¼Œç›¸å¯¹å®‰å…¨çš„åŒ»é™¢é‡Œé€ƒç¦»çš„ç–¯å­ã€‚åœ¨ç–¯å­çš„\"å“„éª—\"ä¸‹ï¼ŒäºŒäººç»“ä¼´è€Œè¡Œï¼Œä¸çŸ¥ä¸è§‰ä¸­ï¼Œæé»˜ä¹Ÿå­¦ä¼šäº†ç–¯å­\"ç²¾ç¥èƒœåˆ©æ³•\"è¿™ä¸€å¥—ç†è®º,å¹¶å°†å…¶ä»˜è¯¸å®è·µã€‚",
                poster: "https://i.imgur.com/peYTYbc.jpeg",
                link: "https://www.dahepiao.com/news1/yanchu/20231031428269.html",
                location: [121.481453, 31.242095] // å¢¨å‰§åœº
            }
        ];

        // å‰§é™¢ä½ç½®ä¿¡æ¯
        const theaterLocations = {
            "å¥¹å‰§åœº": [121.481453, 31.242095],
            "åä¸€æ¥¼å“ªä¸ªå‰§åœº": [121.484589, 31.2399],
            "ä¸Šæµ·èŒ‰è‰èŠ±å‰§åœº": [121.484995, 31.236015],
            "åŒ—äº¬ä¿åˆ©å‰§é™¢": [116.442332, 39.940532],
            "å¤§ä¸–ç•Œ": [121.485864, 31.234196],
            "å¢¨å‰§åœº": [121.481453, 31.242095]
        };

        // åœ°å›¾å’Œæ ‡è®°ç›¸å…³å˜é‡
        let map;
        let markers = {};
        let activeTheater = null;

        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            // åˆ›å»ºåœ°å›¾ï¼Œåˆå§‹è§†å›¾è®¾ç½®ä¸ºä¸­å›½ä¸­éƒ¨
            map = L.map('map').setView([35.8617, 104.1954], 5);
            
            // æ·»åŠ OpenStreetMapåº•å›¾
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // æ·»åŠ æ¼”å‡ºåœ°ç‚¹æ ‡è®°
            updateMapMarkers(performances);
        }

        // æ›´æ–°åœ°å›¾æ ‡è®°
        function updateMapMarkers(filteredPerformances) {
            // æ¸…é™¤æ‰€æœ‰ç°æœ‰æ ‡è®°
            if (markers) {
                Object.values(markers).forEach(markerGroup => {
                    markerGroup.clearLayers();
                });
            }
            markers = {};
            
            // æŒ‰å‰§é™¢åˆ†ç»„æ¼”å‡º
            const performancesByTheater = {};
            filteredPerformances.forEach(performance => {
                if (!performancesByTheater[performance.theater]) {
                    performancesByTheater[performance.theater] = [];
                }
                performancesByTheater[performance.theater].push(performance);
            });
            
            // ä¸ºæ¯ä¸ªå‰§é™¢åˆ›å»ºæ ‡è®°ç»„
            Object.entries(performancesByTheater).forEach(([theater, theaterPerformances]) => {
                const theaterLocation = theaterLocations[theater];
                if (theaterLocation) {
                    const markerGroup = L.layerGroup();
                    
                    // åˆ›å»ºè‡ªå®šä¹‰å›¾æ ‡
                    const theaterIcon = L.divIcon({
                        className: 'theater-marker',
                        html: `<div style="background-color: #d23c3c; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.3);">${theaterPerformances.length}</div>`,
                        iconSize: [30, 30],
                        iconAnchor: [15, 15]
                    });
                    
                    // æ·»åŠ ä¸»æ ‡è®°
                    const marker = L.marker(theaterLocation, {
                        icon: theaterIcon,
                        title: theater
                    }).addTo(markerGroup);
                    
                    // ç»‘å®šå¼¹å‡ºçª—å£
                    let popupContent = `<b style="color:#d23c3c">${theater}</b><hr style="margin:5px 0">`;
                    theaterPerformances.forEach(p => {
                        popupContent += `
                            <div style="margin-bottom:8px;">
                                <div><strong>${p.title}</strong></div>
                                <div>${p.date} ${p.time}</div>
                                <div>ç¥¨ä»·: ${p.price}</div>
                                <a href="${p.link}" target="_blank" style="color:#d23c3c;font-size:0.9em;">è´­ç¥¨ä¿¡æ¯</a>
                            </div>
                        `;
                    });
                    
                    marker.bindPopup(popupContent, {
                        maxWidth: 300,
                        minWidth: 250
                    });
                    
                    // ç‚¹å‡»æ ‡è®°æ—¶é«˜äº®å¯¹åº”çš„å‰§é™¢åˆ—è¡¨é¡¹
                    marker.on('click', function() {
                        highlightTheaterItem(theater);
                    });
                    
                    // ä¿å­˜æ ‡è®°ç»„
                    markers[theater] = markerGroup;
                    markerGroup.addTo(map);
                }
            });
            
            // æ¸²æŸ“å‰§é™¢åˆ—è¡¨
            renderTheaterList(performancesByTheater);
            
            // å¦‚æœæœ‰æ ‡è®°ï¼Œè°ƒæ•´è§†å›¾ä»¥æ˜¾ç¤ºæ‰€æœ‰æ ‡è®°
            if (filteredPerformances.length > 0) {
                const locations = Object.keys(performancesByTheater)
                    .map(theater => theaterLocations[theater])
                    .filter(Boolean);
                
                if (locations.length > 0) {
                    const group = new L.featureGroup(locations);
                    map.fitBounds(group.getBounds().pad(0.2));
                }
            }
        }

        // æ¸²æŸ“å‰§é™¢åˆ—è¡¨
        function renderTheaterList(performancesByTheater) {
            const theaterList = document.getElementById('theaterList');
            theaterList.innerHTML = '';
            
            // ä¸ºæ¯ä¸ªå‰§é™¢åˆ›å»ºåˆ—è¡¨é¡¹
            Object.entries(performancesByTheater).forEach(([theater, theaterPerformances]) => {
                const theaterItem = document.createElement('li');
                theaterItem.className = 'theater-item';
                theaterItem.dataset.theater = theater;
                theaterItem.innerHTML = `
                    <div class="theater-name">${theater}</div>
                    <div class="performance-count">
                        <span>${theaterPerformances.length}åœºæ¼”å‡º</span>
                        <span>${theaterPerformances[0].date}</span>
                    </div>
                `;
                
                theaterItem.addEventListener('click', () => {
                    focusOnTheater(theater);
                });
                
                theaterList.appendChild(theaterItem);
            });
        }

        // é«˜äº®å‰§é™¢åˆ—è¡¨é¡¹
        function highlightTheaterItem(theater) {
            document.querySelectorAll('.theater-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.theater === theater) {
                    item.classList.add('active');
                }
            });
        }

        // èšç„¦åˆ°ç‰¹å®šå‰§é™¢
        function focusOnTheater(theater) {
            // é«˜äº®é€‰ä¸­çš„å‰§é™¢
            highlightTheaterItem(theater);
            
            // å®šä½åˆ°è¯¥å‰§é™¢
            const location = theaterLocations[theater];
            if (location) {
                map.setView(location, 15);
                
                // æ‰“å¼€è¯¥å‰§é™¢çš„å¼¹å‡ºçª—å£
                if (markers[theater]) {
                    markers[theater].eachLayer(layer => {
                        if (layer instanceof L.Marker) {
                            layer.openPopup();
                        }
                    });
                }
            }
        }

        // æ¸²æŸ“å¡ç‰‡è§†å›¾
        function renderCardView(performancesToRender) {
            const cardView = document.getElementById('cardView');
            cardView.innerHTML = '';
            
            if (performancesToRender.length === 0) {
                cardView.innerHTML = '<div class="alert alert-warning">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ¼”å‡º</div>';
                return;
            }
            
            performancesToRender.forEach(performance => {
                const card = document.createElement('div');
                card.className = 'musical-card';
                card.innerHTML = `
                    <div class="flex-container">
                        <div class="flex-content">
                            <div class="musical-title">${performance.title}</div>
                            <div><strong>æ¼”å‡ºæ—¶é—´:</strong> ${performance.date} ${performance.time}</div>
                            <div class="theater-name">${performance.theater}</div>
                            <div><strong>ç¥¨ä»·:</strong> ${performance.price}</div>
                            <p style="margin: 10px 0;">${performance.description}</p>
                            <a href="${performance.link}" target="_blank" class="custom-button">ç«‹å³è´­ç¥¨</a>
                        </div>
                        <div class="flex-img">
                            <img src="${performance.poster}" alt="${performance.title}æµ·æŠ¥" style="width: 100%; border-radius: 5px;">
                        </div>
                    </div>
                `;
                cardView.appendChild(card);
            });
        }

        // æ¸²æŸ“è¡¨æ ¼è§†å›¾
        function renderTableView(performancesToRender) {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            if (performancesToRender.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ¼”å‡º</td></tr>';
                return;
            }
            
            performancesToRender.forEach(performance => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${performance.title}</td>
                    <td>${performance.date}</td>
                    <td>${performance.time}</td>
                    <td>${performance.theater}</td>
                    <td>${performance.price}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // åº”ç”¨ç­›é€‰æ¡ä»¶
        function applyFilters() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const theater = document.getElementById('theaters').value;
            const priceRange = document.getElementById('priceRanges').value;
            const sortBy = document.getElementById('sortBy').value;
            
            let filteredPerformances = [...performances];
            
            // æ—¥æœŸç­›é€‰
            if (startDate) {
                filteredPerformances = filteredPerformances.filter(p => p.date >= startDate);
            }
            if (endDate) {
                filteredPerformances = filteredPerformances.filter(p => p.date <= endDate);
            }
            
            // å‰§é™¢ç­›é€‰
            if (theater !== 'all') {
                filteredPerformances = filteredPerformances.filter(p => p.theater === theater);
            }
            
            // ç¥¨ä»·ç­›é€‰
            if (priceRange !== 'all') {
                filteredPerformances = filteredPerformances.filter(p => p.price === priceRange);
            }
            
            // æ’åº
            filteredPerformances.sort((a, b) => {
                switch (sortBy) {
                    case 'date_asc':
                        return a.date.localeCompare(b.date) || a.time.localeCompare(b.time);
                    case 'date_desc':
                        return b.date.localeCompare(a.date) || b.time.localeCompare(a.time);
                    case 'name_asc':
                        return a.title.localeCompare(b.title);
                    case 'name_desc':
                        return b.title.localeCompare(a.title);
                    case 'theater_asc':
                        return a.theater.localeCompare(b.theater);
                    case 'theater_desc':
                        return b.theater.localeCompare(a.theater);
                    default:
                        return 0;
                }
            });
            
            // æ›´æ–°è®¡æ•°
            document.getElementById('performanceCount').textContent = `æ‰¾åˆ° ${filteredPerformances.length} åœºæ¼”å‡º`;
            
            // é‡æ–°æ¸²æŸ“è§†å›¾
            renderCardView(filteredPerformances);
            renderTableView(filteredPerformances);
            
            // æ›´æ–°åœ°å›¾æ ‡è®°å’Œå‰§é™¢åˆ—è¡¨
            if (document.getElementById('mapView').classList.contains('active')) {
                if (!map) {
                    initMap();
                } else {
                    updateMapMarkers(filteredPerformances);
                }
            }
        }

        // é‡ç½®ç­›é€‰æ¡ä»¶
        function resetFilters() {
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('theaters').value = 'all';
            document.getElementById('priceRanges').value = 'all';
            document.getElementById('sortBy').value = 'date_asc';
            
            applyFilters();
        }

        // è½®æ’­å›¾é€»è¾‘
        let carouselPos = 0;
        const carouselInner = document.getElementById('carouselInner');
        const images = ['https://i.imgur.com/KUOhkeq.jpeg', 'https://i.imgur.com/3KAIyAH.jpeg', 'https://i.imgur.com/VUZF7sX.jpeg', 'https://i.imgur.com/wy2k5Qv.jpeg'];
        
        function rotateCarousel() {
            carouselPos = (carouselPos + 100) % (images.length * 100);
            carouselInner.style.transform = `translateX(-${carouselPos}%)`;
            setTimeout(rotateCarousel, 3000);
        }
        
        // é€‰é¡¹å¡åˆ‡æ¢
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // å¦‚æœåˆ‡æ¢åˆ°åœ°å›¾è§†å›¾ä¸”åœ°å›¾æœªåˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ–åœ°å›¾
            if (tabId === 'mapView' && !map) {
                initMap();
            }
        }
        
        // è¡¨å•æäº¤
        function submitForm() {
            const requiredFields = ['title', 'theater', 'date', 'time', 'price'];
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value) {
                    field.style.borderColor = 'red';
                    isValid = false;
                } else {
                    field.style.borderColor = '#ffd0d0';
                }
            });
            
            if (isValid) {
                // åˆ›å»ºæ–°æ¼”å‡ºå¯¹è±¡
                const newPerformance = {
                    id: performances.length + 1,
                    title: document.getElementById('title').value,
                    theater: document.getElementById('theater').value,
                    date: document.getElementById('date').value,
                    time: document.getElementById('time').value,
                    price: document.getElementById('price').value,
                    description: document.getElementById('description').value || 'æš‚æ— ç®€ä»‹',
                    poster: document.getElementById('poster').value || 'https://via.placeholder.com/300x400?text=æš‚æ— æµ·æŠ¥',
                    link: document.getElementById('link').value || '#',
                    location: theaterLocations[document.getElementById('theater').value] || [35.8617, 104.1954]
                };
                
                // æ·»åŠ åˆ°æ¼”å‡ºæ•°ç»„
                performances.push(newPerformance);
                
                // æ›´æ–°å‰§é™¢ä½ç½®ä¿¡æ¯ï¼ˆå¦‚æœæ–°å‰§é™¢ä¸å­˜åœ¨ï¼‰
                if (!theaterLocations[newPerformance.theater]) {
                    theaterLocations[newPerformance.theater] = [35.8617, 104.1954]; // é»˜è®¤ä¸­å›½ä¸­éƒ¨
                }
                
                // é‡ç½®è¡¨å•
                document.getElementById('addPerformance').reset();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                const successMsg = document.createElement('div');
                successMsg.className = 'alert alert-success';
                successMsg.textContent = `å·²æ·»åŠ  "${newPerformance.title}" çš„æ¼”å‡ºä¿¡æ¯!`;
                document.getElementById('addPerformance').appendChild(successMsg);
                
                // æ›´æ–°ç­›é€‰ç»“æœ
                applyFilters();
                
                // 3ç§’åç§»é™¤æ¶ˆæ¯
                setTimeout(() => {
                    successMsg.remove();
                }, 3000);
            } else {
                const errorMsg = document.createElement('div');
                errorMsg.className = 'alert alert-error';
                errorMsg.textContent = 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ(æ ‡æœ‰*)';
                document.getElementById('addPerformance').appendChild(errorMsg);
                
                // 3ç§’åç§»é™¤æ¶ˆæ¯
                setTimeout(() => {
                    errorMsg.remove();
                }, 3000);
            }
        }
        
        // è®¾ç½®æ›´æ–°æ—¥æœŸ
        document.getElementById('updateDate').textContent = new Date().toLocaleDateString('zh-CN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit'
        });
        
        // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
        const today = new Date();
        const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
        const lastDay = new Date(today.getFullYear(), today.getMonth() + 2, 0);
        
        document.getElementById('startDate').valueAsDate = today;
        document.getElementById('endDate').valueAsDate = lastDay;
        
        // åˆå§‹åŒ–è½®æ’­å›¾
        setTimeout(rotateCarousel, 3000);
        
        // åˆå§‹æ¸²æŸ“
        document.addEventListener('DOMContentLoaded', function() {
            renderCardView(performances);
            renderTableView(performances);
            applyFilters();
        });
    </script>
</body>
</html>